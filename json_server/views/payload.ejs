<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Payload <%= event.payloadId %></title>
  <link rel="stylesheet" href="/state.css" />
</head>
<body class="wrap">
  <h1>Payload <code><%= event.payloadId %></code></h1>

  <div class="meta">
    <% if (sessionId) { %>Session: <code><%= sessionId %></code> — <% } %>
    <% if (flowId) { %>Flow: <code><%= flowId %></code> — <% } %>
    Timestamp: <%= event.timestamp %>
  </div>

  <div class="controls" style="margin: 8px 0 12px;">
    <a class="btn" href="/dashboard/html">← Back to Dashboard</a>
    <a class="btn" href="/payloads/<%= event.payloadId %>.json" target="_blank">View JSON</a>
    <button class="btn btn--primary" onclick="copyPayload()">Copy Payload</button>
  </div>

  <table>
    <thead>
      <tr><th>BeaconId</th><th>Status</th><th>Errors</th></tr>
    </thead>
    <tbody>
      <tr class="<%= event.ValidationStatus === 'Valid' ? 'valid' : 'invalid' %>">
        <td><%= event.BeaconId %></td>
        <td><%= event.ValidationStatus %></td>
        <td>
          <% if (event.formattedErrorList && event.formattedErrorList.length) { %>
            <ul>
              <% event.formattedErrorList.forEach(function(e){ %>
                <li><%= e %></li>
              <% }) %>
            </ul>
          <% } else { %>
            <em>None</em>
          <% } %>
        </td>
      </tr>
    </tbody>
  </table>

  <h2 class="section">Payload</h2>
  <pre id="payload" class="mt-2"><code><%- payloadPretty %></code></pre>

  <script>
    async function copyPayload() {
      const txt = document.getElementById('payload').innerText;
      try { await navigator.clipboard.writeText(txt); alert('Payload copied'); }
      catch (e) { alert('Copy failed: ' + e); }
    }
  </script>
</body>
</html>